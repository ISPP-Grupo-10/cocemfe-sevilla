{% extends "base.html" %}
{% load static %}

{% block title %} Estadísticas de votaciones {% endblock %}

{% block contenido %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>

    <h1>Estadísticas de Votación del documento {{ document.name }}</h1>
    
    <table>
        <thead class="[&amp;_tr]:border-b">
            <tr></tr>
            <tr></tr>
        </thead>
        <tbody>
            {% for data in suggestion_data %}
                <tr>
                    <td>
                        <h2>{{ data.suggestion.main }}</h2>
                        <p>Votos positivos: {{ data.votes_agree }}</p>
                        <p>Votos negativos: {{ data.votes_disagree }}</p>
                        <p>Profesionales que faltan por votar: {{ data.professionals_remaining }}</p>
                    </td>
                    <td style="width: 50px; height: 50px;">
                        <canvas id="chart_canvas_{{ data.suggestion.id }}"></canvas>
                    </td>
                </tr>
                <script>
                    var data_{{ data.suggestion.id }} = [
                        { label: 'Votos positivos', value: {{ data.votes_agree }} },
                        { label: 'Votos negativos', value: {{ data.votes_disagree }} },
                        { label: 'Profesionales restantes', value: {{ data.professionals_remaining }} }
                    ];
                    var chart_{{ data.suggestion.id }} = new Chart(document.getElementById('chart_canvas_{{ data.suggestion.id }}'), {
                        type: 'bar',
                        data: {
                            labels: data_{{ data.suggestion.id }}.map(item => item.label),
                            datasets: [{
                                label: 'Votos',
                                data: data_{{ data.suggestion.id }}.map(item => item.value),
                                backgroundColor: [
                                    'rgba(75, 192, 192, 0.2)',
                                    'rgba(255, 99, 132, 0.2)',
                                    'rgba(255, 206, 86, 0.2)'
                                ],
                                borderColor: [
                                    'rgba(75, 192, 192, 1)',
                                    'rgba(255, 99, 132, 1)',
                                    'rgba(255, 206, 86, 1)'
                                ],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                </script>
            {% endfor %}
        </tbody>     
    </table>
{% endblock %}
