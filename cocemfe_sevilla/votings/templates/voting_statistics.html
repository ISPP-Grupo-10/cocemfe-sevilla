{% extends "base.html" %}
{% load static %}

{% block title %} Estadísticas de votaciones {% endblock %}

{% block contenido %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
    <link rel="stylesheet" href="{% static 'css/list_pdf.css' %}"/>

    <div class="flex flex-col w-full min-h-screen bg-white">
    <div class="border-b dark:border-gray-700">
        <div class="container px-4 py-4 sm:py-6 lg:py-8">
            <div class="space-y-2">
                <h1>Estadísticas de Votación del documento {{ document.name }}</h1>
            </div>
        </div>
    </div>
    <div class="flex flex-col w-full min-h-screen bg-white">
        <div class="flex-1 overflow-y-auto">
            <div class="container flex flex-col gap-4 px-0 py-6 sm:gap-6">
                <div class="w-full px-4 space-y-4 d-flex flex-row justify-content-between">
                    <div class="w-full">
                        <div class="relative w-full overflow-auto">
                            <table class="w-full caption-bottom text-sm">
                                <thead class="[&amp;_tr]:border-b">
                                    <hr>
                                    <tr></tr>
                                    <tr></tr>
                                </thead>
                                <tbody  class="[&amp;_tr:last-child]:border-0">
                                    {% if suggestion_data %}
                                    {% for data in suggestion_data %}
                                        <tr>
                                            <td>
                                                <h2>{{ data.suggestion.main }}</h2>
                                                <p>Votos positivos: {{ data.votes_agree }}</p>
                                                <p>Votos negativos: {{ data.votes_disagree }}</p>
                                                <p>Profesionales que faltan por votar: {{ data.professionals_remaining }}</p>
                                            </td>
                                            <td class="chart">
                                                <canvas id="chart_canvas_{{ data.suggestion.id }}"></canvas>
                                            </td>
                                        </tr>
                                        <script>
                                            var data_{{ data.suggestion.id }} = [
                                                { label: 'Votos positivos', value: {{ data.votes_agree }} },
                                                { label: 'Votos negativos', value: {{ data.votes_disagree }} },
                                                { label: 'Profesionales restantes', value: {{ data.professionals_remaining }} }
                                            ];
                                            var chart_{{ data.suggestion.id }} = new Chart(document.getElementById('chart_canvas_{{ data.suggestion.id }}'), {
                                                type: 'bar',
                                                data: {
                                                    labels: data_{{ data.suggestion.id }}.map(item => item.label),
                                                    datasets: [{
                                                        label: 'Votos',
                                                        data: data_{{ data.suggestion.id }}.map(item => item.value),
                                                        backgroundColor: [
                                                            'rgba(75, 192, 192, 0.2)',
                                                            'rgba(255, 99, 132, 0.2)',
                                                            'rgba(255, 206, 86, 0.2)'
                                                        ],
                                                        borderColor: [
                                                            'rgba(75, 192, 192, 1)',
                                                            'rgba(255, 99, 132, 1)',
                                                            'rgba(255, 206, 86, 1)'
                                                        ],
                                                        borderWidth: 1
                                                    }]
                                                },
                                                options: {
                                                    scales: {
                                                        y: {
                                                            beginAtZero: true,
                                                            ticks: {
                                                                stepSize: 1,
                                                                callback: function(value, index, values) {
                                                                    return parseInt(value);
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            });
                                        </script>
                                    {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="5" class="p-4 text-center">No hay sugerencias disponibles.</td>
                                        </tr>
                                    {% endif %}
                                </tbody>     
                            </table>
                        </div> 
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        td, th {
            width: 900px;
        }
        .chart {
            width: 500px;
            height: 50px;
            margin-left: -50px;
        }
    </style>
    
{% endblock %}
